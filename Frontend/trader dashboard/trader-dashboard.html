<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trader Dashboard — Krishi Mitra</title>

  <!-- Styles -->
  <link rel="stylesheet" href="trader-dashboard.css">

  <!-- Chart.js (for trend charts) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="wrap">
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="logo">KM</div>
        <div class="brand-meta">
          <div class="brand-title">Krishi Mitra</div>
          <div class="brand-sub">Trader Admin</div>
        </div>
      </div>

      <nav class="menu">
        <button class="menu-item active" data-panel="dashboard">Dashboard</button>
        <button class="menu-item" data-panel="market">Market</button>
        <button class="menu-item" data-panel="orders">Orders</button>
        <button class="menu-item" data-panel="inbox">Inbox</button>
        <button class="menu-item" data-panel="settings">Settings</button>
      </nav>

      <div class="sidebar-footer">
        <button id="logoutBtn" class="btn-ghost">Logout</button>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <header class="topbar">
        <div class="top-left">
          <button id="toggleSidebar" class="toggle-btn" aria-label="Toggle sidebar">☰</button>
          <h1 class="page-title">Trader Dashboard</h1>
          <p class="page-sub">Overview • Manage bids, view market and chat</p>
        </div>

        <div class="top-right">
          <div class="search-wrap">
            <input id="globalSearch" class="input search" placeholder="Search crops, bids, farmers..." />
          </div>

          <button id="openChat" class="btn btn-primary">AI Chat</button>

          <div class="profile">
            <div class="avatar">T</div>
            <div class="info">
              <div class="name">Suresh</div>
              <div class="role">Trader</div>
            </div>
          </div>
        </div>
      </header>

      <!-- PANELS -->
      <section id="panels" class="panels">

        <!-- DASHBOARD PANEL -->
        <section class="panel active-panel" id="panel-dashboard">
          <!-- summary cards -->
          <div class="cards">
            <article class="card">
              <div class="card-title">Total Deals</div>
              <div class="card-value">128</div>
              <div class="card-note">Since last month</div>
            </article>

            <article class="card">
              <div class="card-title">Earnings</div>
              <div class="card-value">₹ 45,230</div>
              <div class="card-note">Net received</div>
            </article>

            <article class="card">
              <div class="card-title">Active Bids</div>
              <div class="card-value">17</div>
              <div class="card-note">Open on marketplace</div>
            </article>

            <article class="card">
              <div class="card-title">Unread Messages</div>
              <div class="card-value">4</div>
              <div class="card-note">AI & Farmer messages</div>
            </article>
          </div>

          <!-- main content split -->
          <div class="grid-two">
            <div class="panel-block">
              <div class="panel-header">
                <h3>Market Listings</h3>
                <div class="header-actions">
                  <select id="filterCrop" class="input small">
                    <option value="">All crops</option>
                    <option>Wheat</option><option>Rice</option><option>Corn</option>
                  </select>
                  <button id="refreshMarket" class="btn-ghost small">Refresh</button>
                </div>
              </div>

              <div class="table-wrap">
                <table class="table" id="marketTable">
                  <thead>
                    <tr>
                      <th>Crop</th><th>Qty</th><th>Price (₹)</th><th>Farmer</th><th>Location</th><th></th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- JS fills rows -->
                  </tbody>
                </table>
              </div>
            </div>

            <aside class="panel-block side">
              <div class="panel-header">
                <h3>Price Trends (6 months)</h3>
              </div>
              <div class="chart-wrap">
                <canvas id="trendChart"></canvas>
              </div>

              <div class="mini-cards">
                <div class="mini">
                  <div class="mini-title">Avg Price</div>
                  <div class="mini-value">₹ 24,800</div>
                </div>
                <div class="mini">
                  <div class="mini-title">Volatility</div>
                  <div class="mini-value">Low</div>
                </div>
              </div>
            </aside>
          </div>

          <!-- lower row -->
          <div class="grid-two">
            <div class="panel-block">
              <div class="panel-header">
                <h3>Recent Orders</h3>
                <div class="header-actions">
                  <button id="newOrder" class="btn btn-primary small">New Bid</button>
                </div>
              </div>

              <div class="table-wrap">
                <table class="table" id="ordersTable">
                  <thead><tr><th>ID</th><th>Crop</th><th>Qty</th><th>Value</th><th>Status</th></tr></thead>
                  <tbody><!-- JS --></tbody>
                </table>
              </div>
            </div>

            <aside class="panel-block side">
              <div class="panel-header">
                <h3>Quick Actions</h3>
              </div>
              <div class="quick-list">
                <button id="downloadReport" class="btn-ghost">Download Report</button>
                <button id="manageProfile" class="btn-ghost">Edit Profile</button>
                <button id="openInbox" class="btn-ghost">Open Inbox</button>
              </div>
            </aside>
          </div>
        </section>

        <!-- MARKET PANEL -->
        <section class="panel hidden" id="panel-market">
          <div class="panel-header">
            <h3>Market - All Listings</h3>
            <div class="header-actions">
              <input id="marketSearch" placeholder="Search listing..." class="input small" />
            </div>
          </div>

          <div class="table-wrap">
            <table class="table" id="marketTableFull">
              <thead><tr><th>Crop</th><th>Qty</th><th>Price</th><th>Farmer</th><th>Action</th></tr></thead>
              <tbody><!-- JS --></tbody>
            </table>
          </div>
        </section>

        <!-- ORDERS PANEL -->
        <section class="panel hidden" id="panel-orders">
          <div class="panel-header"><h3>All Orders</h3></div>
          <div class="table-wrap">
            <table class="table" id="allOrdersTable">
              <thead><tr><th>ID</th><th>Crop</th><th>Qty</th><th>Value</th><th>Status</th></tr></thead>
              <tbody><!-- JS --></tbody>
            </table>
          </div>
        </section>

        <!-- INBOX PANEL -->
        <section class="panel hidden" id="panel-inbox">
          <div class="panel-header"><h3>Inbox</h3></div>
          <div class="panel-body">
            <p class="muted">AI chat integrated below — placeholder messages available.</p>
            <div class="inbox-list" id="inboxList"><!-- JS --></div>
          </div>
        </section>

        <!-- SETTINGS PANEL -->
        <section class="panel hidden" id="panel-settings">
          <div class="panel-header"><h3>Settings</h3></div>
          <div class="panel-body">
            <label class="label">Notification Email</label>
            <input class="input" value="trader@example.com" />
            <label class="label">Theme</label>
            <select class="input small"><option>Krishi Green</option><option>Dark</option></select>
            <div style="height:16px"></div>
            <button class="btn btn-primary">Save Settings</button>
          </div>
        </section>

      </section> <!-- /panels -->
    </main>
  </div>

  <!-- AI CHAT MODAL (placeholder) -->
  <div id="aiChat" class="ai-chat hidden" role="dialog" aria-modal="true" aria-label="AI Chat">
    <div class="ai-header">
      <div>Krishi AI Assistant</div>
      <button id="closeAi" class="icon">✕</button>
    </div>
    <div class="ai-body" id="aiBody">
      <div class="ai-note">This chat is a placeholder. Hook your AI or backend here.</div>
      <div class="msg bot">Hello — I can help you find crops, suggest bid prices, or summarize orders.</div>
    </div>
    <div class="ai-footer">
      <input id="aiInput" placeholder="Ask the assistant..." />
      <button id="aiSend" class="btn btn-primary">Send</button>
    </div>
  </div>

  <!-- CREATE BID MODAL -->
  <div id="bidModal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-card">
      <header class="modal-header"><h3>Create Bid</h3><button id="closeBid" class="icon">✕</button></header>
      <form id="bidForm" class="modal-body">
        <label class="label">Crop</label><input name="crop" class="input" required />
        <label class="label">Quantity (e.g., 1 ton)</label><input name="qty" class="input" required />
        <label class="label">Offer Price (₹)</label><input name="price" class="input" required />
        <div class="modal-actions">
          <button type="button" id="cancelBid" class="btn-ghost">Cancel</button>
          <button type="submit" class="btn btn-primary">Submit Bid</button>
        </div>
      </form>
    </div>
  </div>

  <!-- script -->
  <script>
    /* Professional Trader Dashboard - Plain JS
   - No live feeds
   - AI Chat placeholder included
   - Clean admin behaviour (tab switching, modals, chart)
*/

document.addEventListener('DOMContentLoaded', () => {

  /* -----------------------
     Mock (static) data
     ----------------------- */
  const market = [
    { id: 1, crop: 'Wheat', qty: '2 tons', price: 28000, farmer: 'Raju', loc: 'MP' },
    { id: 2, crop: 'Rice', qty: '1.5 tons', price: 24000, farmer: 'Sita', loc: 'Punjab' },
    { id: 3, crop: 'Corn', qty: '500 kg', price: 8000, farmer: 'Rahul', loc: 'Karnataka' },
    { id: 4, crop: 'Soybean', qty: '1 ton', price: 36000, farmer: 'Anil', loc: 'Gujarat' }
  ];
  const orders = [
    { id: 'TR-1001', crop: 'Wheat', qty: '1 ton', value: 14000, status: 'Completed' },
    { id: 'TR-1002', crop: 'Rice', qty: '500 kg', value: 8000, status: 'In Progress' },
    { id: 'TR-1003', crop: 'Corn', qty: '300 kg', value: 4800, status: 'Pending' }
  ];
  const inbox = [
    { from: 'Raju', text: 'Wheat available at ₹28000 for 2 tons', date: '2025-09-30' },
    { from: 'Sita', text: 'Rice ready; need pickup confirmation', date: '2025-09-29' }
  ];

  /* -----------------------
     Utility: dom references
     ----------------------- */
  const menuItems = document.querySelectorAll('.menu-item');
  const panels = document.querySelectorAll('.panel');
  const marketTable = document.querySelector('#marketTable tbody');
  const marketTableFull = document.querySelector('#marketTableFull tbody');
  const ordersTable = document.querySelector('#ordersTable tbody');
  const allOrdersTable = document.querySelector('#allOrdersTable tbody');
  const inboxList = document.getElementById('inboxList');

  /* -----------------------
     Render functions
     ----------------------- */
  function renderMarket() {
    marketTable.innerHTML = '';
    marketTableFull.innerHTML = '';
    market.forEach(item => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${item.crop}</td><td>${item.qty}</td><td>₹ ${item.price.toLocaleString()}</td><td>${item.farmer}</td><td>${item.loc}</td>
                      <td><button class="btn-ghost small view-btn" data-id="${item.id}">View</button></td>`;
      marketTable.appendChild(tr);

      const tr2 = tr.cloneNode(true);
      marketTableFull.appendChild(tr2);
    });
  }

  function renderOrders() {
    ordersTable.innerHTML = '';
    allOrdersTable.innerHTML = '';
    orders.forEach(o => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${o.id}</td><td>${o.crop}</td><td>${o.qty}</td><td>₹ ${o.value.toLocaleString()}</td><td>${o.status}</td>`;
      ordersTable.appendChild(tr);

      const tr2 = tr.cloneNode(true);
      allOrdersTable.appendChild(tr2);
    });
  }

  function renderInbox() {
    inboxList.innerHTML = '';
    inbox.forEach(m => {
      const div = document.createElement('div');
      div.className = 'inbox-item';
      div.style.padding = '8px 0';
      div.innerHTML = `<strong>${m.from}</strong><div style="color:var(--muted);font-size:13px">${m.text}</div><div style="font-size:12px;color:var(--muted)">${m.date}</div>`;
      inboxList.appendChild(div);
    });
  }

  renderMarket(); renderOrders(); renderInbox();

  /* -----------------------
     Panel switching
     ----------------------- */
  menuItems.forEach(item => {
    item.addEventListener('click', () => {
      menuItems.forEach(i => i.classList.remove('active'));
      item.classList.add('active');
      const panelId = 'panel-' + (item.getAttribute('data-panel') || 'dashboard');
      panels.forEach(p => p.classList.add('hidden'));
      const sel = document.getElementById(panelId);
      if (sel) sel.classList.remove('hidden');
      // scroll to top of main
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  });

  /* -----------------------
     Sidebar toggle (mobile)
     ----------------------- */
  const toggleSidebar = document.getElementById('toggleSidebar');
  toggleSidebar.addEventListener('click', () => {
    const sidebar = document.getElementById('sidebar');
    sidebar.style.display = sidebar.style.display === 'none' ? 'flex' : 'none';
  });

  /* -----------------------
     Chart: Price trend (static)
     ----------------------- */
  (function initChart(){
    const ctx = document.getElementById('trendChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['May','Jun','Jul','Aug','Sep','Oct'],
        datasets: [{
          label: 'Avg Price',
          data: [22000,23000,21000,24000,25000,24800],
          borderColor: getComputedStyle(document.documentElement).getPropertyValue('--green').trim() || '#16a34a',
          backgroundColor: 'rgba(22,163,74,0.08)',
          tension: 0.3,
          fill: true,
          pointRadius: 3
        }]
      },
      options: { responsive:true, plugins:{legend:{display:false}} }
    });
  })();

  /* -----------------------
     AI Chat (placeholder)
     ----------------------- */
  const aiChat = document.getElementById('aiChat');
  const openChat = document.getElementById('openChat');
  const closeAi = document.getElementById('closeAi');
  const aiSend = document.getElementById('aiSend');
  const aiInput = document.getElementById('aiInput');
  const aiBody = document.getElementById('aiBody');

  openChat.addEventListener('click', () => aiChat.classList.toggle('hidden'));
  closeAi.addEventListener('click', () => aiChat.classList.add('hidden'));
  aiSend.addEventListener('click', sendAi);
  aiInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') sendAi(); });

  function sendAi(){
    const text = aiInput.value.trim();
    if (!text) return;
    appendMessage('user', text);
    aiInput.value = '';
    // placeholder reply (simulate small processing)
    setTimeout(() => {
      appendMessage('bot', `I'm a placeholder AI. You asked: "${text}". Replace this with your AI integration (API/websocket).`);
    }, 350);
  }

  function appendMessage(who, text){
    const div = document.createElement('div');
    div.className = 'msg ' + (who==='bot' ? 'bot' : 'user');
    div.style.marginBottom = '8px';
    div.textContent = text;
    aiBody.appendChild(div);
    aiBody.scrollTop = aiBody.scrollHeight;
  }

  /* -----------------------
     Modals: Create Bid
     ----------------------- */
  const bidModal = document.getElementById('bidModal');
  const newOrderBtn = document.getElementById('newOrder');
  const closeBid = document.getElementById('closeBid');
  const cancelBid = document.getElementById('cancelBid');
  const bidForm = document.getElementById('bidForm');

  newOrderBtn.addEventListener('click', () => bidModal.classList.remove('hidden'));
  closeBid.addEventListener('click', () => bidModal.classList.add('hidden'));
  cancelBid.addEventListener('click', () => bidModal.classList.add('hidden'));
  bidForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const fd = new FormData(bidForm);
    const payload = Object.fromEntries(fd.entries());
    // mock submission - you will replace with real API
    orders.unshift({ id: 'TR-' + (1000 + orders.length + 1), crop: payload.crop, qty: payload.qty, value: payload.price, status: 'Pending' });
    renderOrders();
    bidModal.classList.add('hidden');
    bidForm.reset();
    alert('Bid created (mock). Replace with actual API call.');
  });

  /* -----------------------
     small UI actions
     ----------------------- */
  document.getElementById('refreshMarket').addEventListener('click', () => {
    // mock refresh visual
    alert('Market refreshed (mock). Connect to API to load real data.');
  });

  document.getElementById('downloadReport').addEventListener('click', () => {
    alert('Downloading report (mock). Implement CSV/PDF export on backend.');
  });

  document.getElementById('openInbox').addEventListener('click', () => {
    document.querySelector('.menu-item[data-panel="inbox"]').click();
  });

  // search filters
  document.getElementById('marketSearch')?.addEventListener('input', (e) => {
    const q = e.target.value.toLowerCase();
    document.querySelectorAll('#marketTableFull tbody tr').forEach(tr => {
      tr.style.display = tr.textContent.toLowerCase().includes(q) ? '' : 'none';
    });
  });

  document.getElementById('globalSearch')?.addEventListener('input', (e) => {
    const q = e.target.value.toLowerCase();
    // filter small sample: hide rows that don't match in visible market table
    document.querySelectorAll('#marketTable tbody tr').forEach(tr => {
      tr.style.display = tr.textContent.toLowerCase().includes(q) ? '' : 'none';
    });
  });

  // delegated click: view buttons
  document.addEventListener('click', (ev) => {
    const t = ev.target;
    if (t.matches('.view-btn')) {
      const id = t.getAttribute('data-id');
      alert('View listing id: ' + id + ' (mock). Open detail modal or navigate to listing page.');
    }
  });

}); // DOMContentLoaded

  </script>
</body>
</html>
