<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trader Dashboard | Krishi Mitra</title>
  <link rel="stylesheet" href="/Frontend/trader dashboard/trader-dashboard.css" />
</head>
<body>

  <header>
    <h1>ğŸŒ¾ Krishi Mitra â€“ Trader Dashboard</h1>
    <a href="/Frontend/trader dashboard/trader-account.html" class="navbar">My Account</a>
      <a href="#" class="navbar">ğŸ“¦ My Orders</a>
      <a href="#" class="navbar">ğŸ” Browse Produce</a>
      <a href="#" class="navbar">ğŸ’¬ Chat with Farmers</a>
      <a href="#" class="navbar">ğŸ“ˆ Analytics</a>
    <button onclick="logout()">Logout</button>
  </header>

  <div class="dashboard">
     <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar">
  <img id="sidebar-profile img" src="images/default.png" alt="Trader Photo" class="profile-photo">
  <h3 id="profile-card h3">Trader Name</h3>
  <p><strong>Email:</strong> <span id="traderEmail"></span></p>
  <p><strong>Phone:</strong> <span id="traderPhone"></span></p>
</div>
  </div>

    <main>
      <div class="card">
        <h3>Recent Requests</h3>
        <table>
          <thead>
            <tr>
              <th>Product</th>
              <th>Farmer</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="requestTable"></tbody>
        </table>
      </div>
    </main>
  </div>
  <div id="toast" class="toast"></div>

  <script>
    // Fake requests (for demo)
    const sampleData = [
      { id: 1, product: "Potatos", farmer: "Suresh Patel", status: "Requested" },
      { id: 2, product: "Onions", farmer: "Rajesh Mehta", status: "Approved" },
    ];

    function loadRequests() {
      const table = document.getElementById("requestTable");
      table.innerHTML = "";
      sampleData.forEach(req => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${req.product}</td>
          <td>${req.farmer}</td>
          <td>${req.status}</td>
          <td>${
            req.status === "Requested"
              ? `<button onclick="sendRequest(${req.id})">Send Request</button>`
              : "â€”"
          }</td>
        `;
        table.appendChild(row);
      });
    }

    // Toast notification
    function showToast(message) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 4000);
    }

    // Simulated Request Sending
    function sendRequest(id) {
      showToast("Request sent to farmer...");
      // After confirmation (simulate)
      setTimeout(() => {
        localStorage.setItem(
          "approvedRequest",
          JSON.stringify({ farmerName: "Suresh Patel", farmerMobile: "9998877766" })
        );
        checkForApproval();
      }, 2500);
    }

    // Check if farmer approved
    function checkForApproval() {
      const approved = JSON.parse(localStorage.getItem("approvedRequest"));
      if (approved) {
        showToast(
          `ğŸ“ Farmer ${approved.farmerName} confirmed your order! Contact: ${approved.farmerMobile}`
        );
        localStorage.removeItem("approvedRequest");
      }
    }

    function logout() {
      showToast("Logging out...");
      setTimeout(() => (window.location.href = "index.html"), 2000);
    }

    window.onload = () => {
      loadRequests();
      checkForApproval();
    };

  // Load user data from localStorage
  const userData = JSON.parse(localStorage.getItem("userProfile"));

  if (userData) {
    document.getElementById("traderName").textContent = userData.fullName || "Trader Name";
    document.getElementById("traderEmail").textContent = userData.email || "N/A";
    document.getElementById("traderPhone").textContent = userData.phone || "N/A";

    const traderPhoto = document.getElementById("traderPhoto");
    traderPhoto.src = userData.profilePhoto || "images/default.png";
  } else {
    console.warn("âš ï¸ No trader data found in localStorage.");
  }
window.addEventListener("storage", () => {
  location.reload();
});

  </script>
</body>
</html>
